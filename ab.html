<!DOCTYPE html>
<html>
<meta name="viewport" content="user-scalable=no" />

<HEAD>
    <TITLE>Kueng Caputo Unlimited</TITLE>
    <script src="ab/js/jquery-3.6.0.min.js"></script>
    <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
    <link rel="stylesheet" href="ab/style.css">
</HEAD>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

<style>

</style>

<script>
    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);
    let objectNmbr = urlParams.get('o');

    console.log(objectNmbr);
    if (objectNmbr) {
        if (objectNmbr < 1 || objectNmbr > 200) {
            alert("falscher Link! - versuche es mit https://www.kueng-caputo.ch/ab.html?o=21");
        }
    }



    /*            //Poster 1: Von links nach rechts:
            // Arbeitsname:
            list[1] = "Fendi_KuengCaputo_RomanMolds_2019_p1.reality,1.6 MB,2.2 MB",
            // Arbeitsname:
            list[2] = "Fendi_KuengCaputo_RomanMolds_2019_p2.reality,1.6 MB,2.2 MB",
            // Arbeitsname:
            list[3] = "Fendi_KuengCaputo_RomanMolds_2019_p1.reality,1.6 MB,2.2 MB",
            // Arbeitsname:
            list[4] = "Fendi_KuengCaputo_RomanMolds_2019_p2.reality,1.6 MB,2.2 MB",
            // Arbeitsname:
            list[5] = "Fendi_KuengCaputo_RomanMolds_2019_p1.reality,1.6 MB,2.2 MB",
            // Arbeitsname:
            list[6] = "Fendi_KuengCaputo_RomanMolds_2019_p2.reality,1.6 MB,2.2 MB",
    
     */

    let list = [];

    //Poster 2: Von links nach rechts:
    // Arbeitsname:
    list[12] = "Fendi_KuengCaputo_RomanMolds_2019_1.reality,2.0 MB,6.1 MB",
        // Arbeitsname:
        list[7] = "KuengCaputo_CosaPensi_Poster_2020.reality,4.9 MB,8.3 M",
        // Arbeitsname:
        list[8] = "Fendi_KuengCaputo_RomanMolds_2019_1.reality,1.9 MB,6.4 MB",
        // Arbeitsname:
        list[9] = "KuengCaputo_CosaPensi_Poster_2020.reality,4.9 MB,8.3 MB",
        // Arbeitsname:
        list[10] = "Fendi_KuengCaputo_RomanMolds_2019_1.reality,3.1 MB,7.5 MB",


        //Poster 1: Von links nach rechts:
        // Arbeitsname:
        list[1] = "KuengCaputo_SandChair_2012.reality,2.0 MB,6.1 MB", //√
        // Arbeitsname:
        list[2] = "KuengCaputo_TooHardToBeTrue_2014.reality,2.3 MB,9.7 MB",//√-paola
        // Arbeitsname:
        list[3] = "KuengCaputo_SiloFurniture_2017.reality,1.9 MB,6.4 MB", //√
        // Arbeitsname:
        list[4] = "KuengCaputo_SandChair_2018.reality,1.5 MB,5.0 MB", //√
        // Arbeitsname:
        list[5] = "Fendi_KuengCaputo_RomanMolds_2019.reality,3.1 MB,7.5 MB", //√
        // Arbeitsname:
        list[6] = "KuengCaputo_CosaPensi3_2020.reality,3.1 MB,7.5 MB", //√


        //Wallpaper QR1: Backsteinlampen:
        list[22] = "KuengCaputo_CosaPensi1_2020.reality,4.9 MB,8.1 MB",
        //Wallpaper QR2: Blauer Sandhocker:
        list[21] = "KuengCaputo_SandChair_l_2012.reality,2 MB,5.9 MB",
        //Wallpaper QR3: Gruener Bogen //Evt. Fendi Pult später
        list[23] = "KuengCaputo_CosaPensi2_2020.reality,5.1 MB,13 MB",
        //Wallpaper QR4: Facemapping
        list[24] = "Fendi_KuengCaputo_RomanMolds_f_2019.reality,13.7 MB,8.1 MB",


        // Insta:
        list[100] = "KuengCaputo_CosaPensi3_2020.usdz,3.1 MB,3.1 MB",
        list[101] = "KuengCaputo_TooHardToBeTrue_2014.usdz,2.3 MB,3.1 MB",
        list[102] = "KuengCaputo_SandChair_2012.reality,2.0 MB,1.8 MB",
        list[103] = "teppich1.usdz,2.4 MB,2.4 MB",
        list[104] = "asd",
        list[105] = "asd",
        list[106] = "asd",
        list[107] = "asd",
        list[108] = "asd",
        list[109] = "asd",
        list[110] = "asd",
        list[111] = "asd",
        list[112] = "asd",
        list[113] = "asd",

        console.log(list);



    function fakeLoader(target, objectNmbrS) {
        console.log("objectNmnr:" + objectNmbrS)
        $("#" + objectNmbrS).addClass("selected");
        console.log("fakeLoader" + target);
        $("#" + target).append("<div id='loadingDiv' class='loading'><progress class='pure-material-progress-circular' /></div>");
        $("#click").empty();
        $("#ar-button").addClass("invisible");
        var myTimer = setInterval(checkFocus, 300);

        setInterval(() => {
            $("#loadingDiv").remove();
            //$("#" + objectNmbrS).removeClass("selected");
            clearInterval(myTimer);
        }, 10000);

        function checkFocus() {
            if (document.hasFocus()) {
                console.log("hasfocus");
            }
            else {
                console.log("has no focus");
                $("#loadingDiv").remove();
                //$("#" + objectNmbrS).removeClass("selected");
                clearInterval(myTimer);
            }
        }
    };


    createiOSIntro = function (target) {
        let objectNameiOS = list[objectNmbr].split(',')[0];
        let objectSizeiOS = list[objectNmbr].split(',')[2];
        let objectName = list[objectNmbr].split('.')[0];
        console.log(objectName);
        var iosLink = document.createElement("a");
        //iosLink.type = "text/css";
        iosLink.rel = "ar";
        iosLink.href = "ab/assets/" + objectName + "/" + objectNameiOS;
        iosLink.innerHTML = '<img src="ab/assets/' + objectName + '/' + objectName + '.jpg" id="imgSize" class="imgClass">';
        iosLink.id = objectNmbr;
        iosLink.onclick = function () { fakeLoader(target, this.id); }
        if (target == "index") {
            $("#" + target).append('<div class="fileInIndex" id="' + objectNmbr + '"></div>');
            $("#" + objectNmbr).append(iosLink);
            return;
        }
        $("#" + target).append(iosLink);
        $("#" + target).append('<div id="click" class="click">click it</div><div id="size" class="size">' + objectSizeiOS + '</div>');
    }

    createAndroidIntro = function (target) {
        console.log(list[objectNmbr].split('.')[0] + target);
        let objectSizeGLB = list[objectNmbr].split(',')[1];
        let objectName = list[objectNmbr].split('.')[0];
        if (target == "index") {
            $("#" + target).append('<div class="fileInIndex" id="' + objectNmbr + '"></div>');
            $("#" + objectNmbr).append('<model-viewer src="ab/assets/' + objectName + '/' + objectName + '.glb" poster="ab/assets/' + objectName + '/' + objectName + '.jpg" ar ar-modes="webxr scene-viewer" reveal = "interaction" environment - image="neutral" camera-controls ios-src="ab/assets/' + objectName + '/' + objectName + '.usdz" ><button slot="ar-button" id="ar-button" onclick="fakeLoader(\'' + target + '\',' + objectNmbr + ')"><img class="imgClass" src="ab/assets/' + objectName + '/' + objectName + '.jpg"></button></model - viewer > ');
            return;
        }
        //direct intent link:
        //$("#" + target).append('<a href="intent://arvr.google.com/scene-viewer/1.0?file=https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/Avocado/glTF/Avocado.gltf#Intent;scheme=https;package=com.google.android.googlequicksearchbox;action=android.intent.action.VIEW;S.browser_fallback_url=https://developers.google.com/ar;end;"><img class="imgClass" src="ab/assets/' + objectName + '/' + objectName + '.jpg">Avocado</a>');


        $("#" + target).append('<model-viewer src="ab/assets/' + objectName + '/' + objectName + '.glb" poster="ab/assets/' + objectName + '/' + objectName + '.jpg" ar ar-modes="webxr scene-viewer" loading="eager" reveal="auto" environment-image="neutral" camera-controls ios-src="ab/assets/' + objectName + '/' + objectName + '.usdz"><button slot="ar-button" id="ar-button" onclick="fakeLoader(\'' + target + '\',' + objectNmbr + ')"><img class="imgClass" src="ab/assets/' + objectName + '/' + objectName + '.jpg"></button></model - viewer > ');
        $("#" + target).append('<div id="click" class="click">click it</div>');
        $("#" + target).append('<div id="size" class="size">' + objectSizeGLB + '<br><span class="material-icons">download</span></div>');
    }

    createIndex = function (device) {
        console.log("createIndex");

        list.forEach(function (item, index) {
            if (item.length > 2) {
                objectNmbr = index;
                if (device == "iphone") {
                    createiOSIntro("index")
                } else {
                    createAndroidIntro("index");
                }
            }
        })

        $('#fullON').addClass("invisible");
        $('#index').removeClass("invisible");
    }

    $(document).ready(function () {
        console.log("ready!");


        //alert("Preview Version: V5 \n\nbitte screenshots machen, merci");
        //sonstiger Apple check:

        /* 
                const isMobile = ('ontouchstart' in document.documentElement && navigator.userAgent.match(/Mobi/));
        
                if (isMobile) {
         */
        console.log(navigator.userAgent);
        if (/iPhone|iPad|iPod/i.test(navigator.userAgent)) {

            //alert("Die Seite wird aufgerufen mit einem iPhone: richtig?\n \n" + navigator.userAgent);

            const a = document.createElement("a");
            if (a.relList.supports("ar")) {
                //alert("iOS AR sollte auf diesem Handy funktionieren");
            } else {
                //alert("kein Support fuer AR, mal schauen ob es trotzdem geht...?");
                createAndroidIntro("fullON");
                return;
            }
            // iPhone
            if (!objectNmbr) {
                createIndex("iphone");
                return;
            }
            createiOSIntro("fullON");
        } else {
            //alert("Die Seite wird aufgerufen mit einem Android Mobile Phone: richtig?\n \n" + navigator.userAgent);
            // Android
            if (!objectNmbr) {
                createIndex("android");
                return;
            }
            createAndroidIntro("fullON");
        }
        /*         } else {
                    // Desktop
                    alert("desktop!");
                    $("#errorDiv").removeClass("invisible");
                    //alert("Desktop:" + navigator.userAgent);
                } */
    });


</script>

<body>

    <div id="errorDiv" class="invisible errorMode">device not supported</div>

    <div id="fullON" class="fullOn"></div>

    <div id="index" class="index invisible"></div>


</body>

</html>