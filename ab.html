<!DOCTYPE html>
<html>
<meta name="viewport" content="user-scalable=no" />

<HEAD>
    <TITLE>Kueng Caputo Unlimited</TITLE>
    <script src="ab/js/jquery-3.6.0.min.js"></script>
    <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
    <link rel="stylesheet" href="ab/style.css">
</HEAD>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

<style>

</style>

<script>
    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);
    let objectNmbr = urlParams.get('o');



    let list = [];
        list[1] = "asif5",
        list[2] = "fendi_hocker1",
        list[3] = "sandhocker_1",
        list[4] = "sandhocker_2",
        list[5] = "sandhocker_3",
        list[6] = "teppich1",
        list[7] = "silo_tisch_sml",
        list[8] = "Steinlampe",
        list[9] = "Silo_Hocker_1",
        list[21] = "marmor_hocker_1",
        list[22] = "asif1",
        list[23] = "backsteinlampe",
        list[24] = "saeulen",

        console.log(list);

    let fileSizes = [];
        fileSizes[1] = "1.8mb" //"asif5",
        fileSizes[2] = "3.1mb" //"fendi_hocker1",
        fileSizes[3] = "1.8mb" //"sandhocker_1",
        fileSizes[4] = "1.7mb" //"sandhocker_2",
        fileSizes[5] = "1.4mb" //"sandhocker_3",
        fileSizes[6] = "2.4mb" //"teppich1",
        fileSizes[7] = "4.4mb" //"silo_tisch_sml",
        fileSizes[8] = "34.4mb" //"Steinlampe",
        fileSizes[8] = "12.4mb" // "Silo_Hocker_1",
        fileSizes[21] = "3.1mb" //"marmor_hocker_1",
        fileSizes[22] = "1.3mb" //"asif1",
        fileSizes[23] = "4.4mb" //"backsteinlampe",
        fileSizes[24] = "7.2mb" //"saeulen",

        console.log(fileSizes);


    function fakeLoader(target, objectNmbrS) {
        console.log("objectNmnr:" + objectNmbrS)
        $("#" + objectNmbrS).addClass("selected");
        console.log("fakeLoader" + target);
        $("#" + target).append("<div id='loadingDiv' class='loading'><progress class='pure-material-progress-circular' /></div>")
        var myTimer = setInterval(checkFocus, 300);

        setInterval(() => {
            $("#loadingDiv").remove();
            //$("#" + objectNmbrS).removeClass("selected");
            clearInterval(myTimer);
        }, 10000);

        function checkFocus() {
            if (document.hasFocus()) {
                console.log("hasfocus");
            }
            else {
                console.log("has no focus");
                $("#loadingDiv").remove();
                //$("#" + objectNmbrS).removeClass("selected");
                clearInterval(myTimer);
            }
        }
    };


    createiOSIntro = function (target) {
        console.log(list[objectNmbr]);
        var iosLink = document.createElement("a");
        //iosLink.type = "text/css";
        iosLink.rel = "ar";
        iosLink.href = "ab/assets/" + list[objectNmbr] + "/" + list[objectNmbr] + ".usdz";
        iosLink.innerHTML = '<img src="ab/assets/' + list[objectNmbr] + '/' + list[objectNmbr] + '.jpg" id="imgSize" class="imgClass"><p>' + list[objectNmbr] + '.usdz<br>' + fileSizes[objectNmbr] + '</p>';
        iosLink.id = objectNmbr;
        iosLink.onclick = function () { fakeLoader(target, this.id); }
        if(target=="index"){
            $("#" + target).append('<div class="fileInIndex" id="' + objectNmbr + '"></div>');
            $("#" + objectNmbr).append(iosLink);
            return;
        }
        $("#" + target).append(iosLink);
    }

    createAndroidIntro = function (target) {
        console.log(list[objectNmbr] + target);
        $("#" + target).append('<model-viewer src="ab/assets/' + list[objectNmbr] + '/' + list[objectNmbr] + '.glb" poster="ab/assets/' + list[objectNmbr] + '/' + list[objectNmbr] + '.jpg" ar ar-modes="webxr scene-viewer" reveal = "interaction" environment - image="neutral" camera-controls ><button slot="ar-button" id="ar-button" onclick="fakeLoader(\'' + target + '\',' + objectNmbr + ')"><img class="imgClass" src="ab/assets/' + list[objectNmbr] + '/' + list[objectNmbr] + '.jpg"></button></model - viewer > ');
       
    }

    createIndex = function (device) {
        console.log("createIndex");

        list.forEach(function (item, index) {
            if (item.length > 2) {
                objectNmbr = index;
                if (device == "iphone") {
                    createiOSIntro("index")
                } else {
                    createAndroidIntro("index");
                }
            }
        })

        $('#fullON').addClass("invisible");
        $('#index').removeClass("invisible");
    }

    $(document).ready(function () {
        console.log("ready!");


        //alert("Preview Version - Testen bitte ab Dienstag: Bitte Fehler mit Screenshot mir zusenden. Wer hat alles ein Android telefon? Unterst√ºtzt werden (up-to-date) iPhones ab nr 7, Android phones: https://developers.google.com/ar/devices");
        //sonstiger Apple check:
        const a = document.createElement("a");
        if (a.relList.supports("ar")) {
            //alert("iOS AR available");
        }


        if ($(window).width() < 1100) {

            if (/iPhone|iPad|iPod/i.test(navigator.userAgent)) {

                //alert("iphone:" + navigator.userAgent);
                // iPhone
                if (!objectNmbr) {
                    createIndex("iphone");
                    return;
                }
                createiOSIntro("fullON");
            } else {
                //alert("android:" + navigator.userAgent);
                // Android
                if (!objectNmbr) {
                    createIndex("android");
                    return;
                }
                createAndroidIntro("fullON");
            }
        } else {
            // Desktop
            //alert("desktop:" + navigator.userAgent);
            $("#errorDiv").removeClass("invisible");
            //alert("Desktop:" + navigator.userAgent);
        }
    });


</script>

<body>

    <div id="errorDiv" class="invisible errorMode">ü§∑‚Äç‚ôÇÔ∏è<br>device not supported<br>ü§≥</div>

    <div id="fullON" class="fullOn"></div>

    <div id="index" class="index invisible"></div>


</body>

</html>