<!DOCTYPE html>
<html>
<meta name="viewport" content="user-scalable=no" />

<HEAD>
    <TITLE>Kueng Caputo Unlimited</TITLE>
    <script src="ab/js/jquery-3.6.0.min.js"></script>
    <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
    <link rel="stylesheet" href="ab/style.css">
</HEAD>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

<style>

</style>

<script>
    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);
    let objectNmbr = urlParams.get('o');



    let list = [];
    list[21] = "marmor_hocker_francesca",
        list[22] = "KC_Vase_1",
        list[23] = "backsteinlampe",
        list[24] = "saeulen",
        list[1] = "asif5",
        list[2] = "fendi_jocker_small",
        list[3] = "sandhocker1",
        list[4] = "sandhocker_2",
        list[5] = "",
        list[6] = "",
        list[7] = "",
        list[8] = "",
        list[9] = "",
        list[10] = "",
        list[11] = "",
        list[12] = "",
        list[13] = "",
        list[14] = "",
        list[15] = "",
        list[16] = "",
        list[17] = "",
        list[18] = "",
        list[19] = "",
        list[20] = "",
        list[1] = "",
        list[1] = "",

        console.log(list);


    function fakeLoader(target) {
        console.log("fakeLoader" + target);
        $("#" + target).append("<div id='loadingDiv' class='loading'><progress class='pure-material-progress-circular' /></div>")
        var myTimer = setInterval(checkFocus, 300);

        setInterval(() => {
            $("#loadingDiv").remove();
            clearInterval(myTimer);
        }, 10000);

        function checkFocus() {
            if (document.hasFocus()) {
                console.log("hasfocus");
            }
            else {
                console.log("has no focus");
                $("#loadingDiv").remove();
                clearInterval(myTimer);
            }
        }
    };


    createiOSIntro = function (target) {
        console.log(list[objectNmbr]);

        var iosLink = document.createElement("a");
        //iosLink.type = "text/css";
        iosLink.rel = "ar";
        iosLink.href = "ab/assets/" + list[objectNmbr] + ".usdz";
        iosLink.innerHTML = '<img src="ab/assets/' + list[objectNmbr] + '.jpg" id="imgSize" class="imgClass">';
        iosLink.id = "iosLink"
        iosLink.onclick = function () { fakeLoader(target); }
        $("#" + target).append(iosLink);
    }

    createAndroidIntro = function (target) {
        console.log(list[objectNmbr] + target);
        $("#" + target).append('<model-viewer src="ab/assets/vase_e_2.glb" poster="ab/assets/' + list[objectNmbr] + '.jpg" ar ar-modes="webxr scene-viewer" reveal = "interaction" environment - image="neutral" camera-controls ><button slot="ar-button" id="ar-button" onclick="fakeLoader(\'' + target + '\')"><img class="imgClass" src="ab/assets/' + list[objectNmbr] + '.jpg"></button></model - viewer > ');
        //$("#fullON").onclick = function () { fakeLoader(target); }
    }

    createIndex = function (device) {
        console.log("createIndex");

        list.forEach(function (item, index) {
            if (item.length > 2) {
                objectNmbr = index;
                if (device == "iphone") {
                    createiOSIntro("index")
                } else {
                    createAndroidIntro("index");
                }
            }
        })

        $('#fullON').addClass("invisible");
        $('.imgClass').addClass('img-override')
    }

    $(document).ready(function () {
        console.log("ready!");


        //sonstiger Apple check:
        const a = document.createElement("a");
        if (a.relList.supports("ar")) {
            alert("iOS AR available");
        }



        if (/iPhone|iPad|iPod/i.test(navigator.userAgent)) {
            // iPhone
            if (!objectNmbr) {
                createIndex("iphone");
                return;
            }
            createiOSIntro("fullON");
        } else if (/Android|webOS|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
            // Android
            if (!objectNmbr) {
                createIndex("android");
                return;
            }
            createAndroidIntro("fullON");
        } else {
            // Desktop
            alert("desktop:" + navigator.userAgent);
            $("#errorDiv").removeClass("invisible");
            alert("Desktop:" + navigator.userAgent);
        }
    });


</script>

<body>

    <div id="errorDiv" class="invisible errorMode">ü§∑‚Äç‚ôÇÔ∏è<br>device not supported<br>ü§≥</div>

    <div id="fullON" class="fullOn"></div>

    <div id="index" class="index"></div>


</body>

</html>