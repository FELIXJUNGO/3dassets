<!DOCTYPE html>
<html>
<meta name="viewport" content="user-scalable=no" />

<HEAD>
    <TITLE>Kueng Caputo Unlimited</TITLE>
    <script src="ab/js/jquery-3.6.0.min.js"></script>
    <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
    <link rel="stylesheet" href="ab/style.css">
</HEAD>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

<style>

</style>

<script>
    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);
    let objectNmbr = urlParams.get('o');



    if (objectNmbr < 21 || objectNmbr > 23) {
        alert("falscher Link! - versuche es mit https://www.kueng-caputo.ch/ab.html?o=21");
    }

    let list = [];

    //Poster 2:
    list[1] = "backsteinlampe.reality,4.9mb,8.3mb",
        list[2] = "sandhocker.reality,_glb_?_mb,_usdz_?_mb",
        list[3] = "sandhocker_1.usdz,_glb_?_mb,_usdz_?_mb",
        list[4] = "sandhocker_2.usdz,_glb_?_mb,_usdz_?_mb",
        list[5] = "sandhocker_3.usdz,_glb_?_mb,_usdz_?_mb",


        //Poster 1:

        list[6] = "teppich1.usdz",
        list[7] = "silo_tisch_sml.usdz",
        list[8] = "Steinlampe.usdz",
        list[9] = "Silo_Hocker_1.usdz",


        //Wallpaper QR1: Fendi Palmen:
        list[22] = "backsteinlampe.reality,4.9mb,8.3mb",
        //Wallpaper QR2: Blauer Sandhocker:
        list[21] = "sandhocker.reality,2mb,5.9mb",
        //Wallpaper QR3: Gruener Bogen //Evt. Fendi Pult sp√§ter
        list[20] = "gruener_bogen.reality,11.6mb,22.5mb",
        //Wallpaper QR4: Facemapping
        list[23] = "facemapping.reality,1.9mb,43.2mb",



        list[25] = "gruener_bogen.usdz,_glb_?_mb,_usdz_?_mb",
        list[26] = "ONOFFtable.usdz,_glb_?_mb,_usdz_?_mb",

        console.log(list);



    function fakeLoader(target, objectNmbrS) {
        console.log("objectNmnr:" + objectNmbrS)
        $("#" + objectNmbrS).addClass("selected");
        console.log("fakeLoader" + target);
        $("#" + target).append("<div id='loadingDiv' class='loading'><progress class='pure-material-progress-circular' /></div>");
        $("#click").empty();
        $("#ar-button").addClass("invisible");
        var myTimer = setInterval(checkFocus, 300);

        setInterval(() => {
            $("#loadingDiv").remove();
            //$("#" + objectNmbrS).removeClass("selected");
            clearInterval(myTimer);
        }, 10000);

        function checkFocus() {
            if (document.hasFocus()) {
                console.log("hasfocus");
            }
            else {
                console.log("has no focus");
                $("#loadingDiv").remove();
                //$("#" + objectNmbrS).removeClass("selected");
                clearInterval(myTimer);
            }
        }
    };


    createiOSIntro = function (target) {
        let objectNameiOS = list[objectNmbr].split(',')[0];
        let objectSizeiOS = list[objectNmbr].split(',')[2];
        let objectName = list[objectNmbr].split('.')[0];
        console.log(objectName);
        var iosLink = document.createElement("a");
        //iosLink.type = "text/css";
        iosLink.rel = "ar";
        iosLink.href = "ab/assets/" + objectName + "/" + objectNameiOS;
        iosLink.innerHTML = '<img src="ab/assets/' + objectName + '/' + objectName + '.jpg" id="imgSize" class="imgClass"><div id="click" class="click">click it</div><div id="size" class="size">' + objectSizeiOS + '</div>';
        iosLink.id = objectNmbr;
        iosLink.onclick = function () { fakeLoader(target, this.id); }
        if (target == "index") {
            $("#" + target).append('<div class="fileInIndex" id="' + objectNmbr + '"></div>');
            $("#" + objectNmbr).append(iosLink);
            return;
        }
        $("#" + target).append(iosLink);
    }

    createAndroidIntro = function (target) {
        console.log(list[objectNmbr].split('.')[0] + target);
        let objectSizeGLB = list[objectNmbr].split(',')[1];
        let objectName = list[objectNmbr].split('.')[0];
        if (target == "index") {
            $("#" + target).append('<div class="fileInIndex" id="' + objectNmbr + '"></div>');
            $("#" + objectNmbr).append('<model-viewer src="ab/assets/' + objectName + '/' + objectName + '.glb" poster="ab/assets/' + objectName + '/' + objectName + '.jpg" ar ar-modes="webxr scene-viewer" reveal = "interaction" environment - image="neutral" camera-controls ios-src="ab/assets/' + objectName + '/' + objectName + '.usdz" ><button slot="ar-button" id="ar-button" onclick="fakeLoader(\'' + target + '\',' + objectNmbr + ')"><img class="imgClass" src="ab/assets/' + objectName + '/' + objectName + '.jpg"></button></model - viewer > ');
            return;
        }
        //direct intent link:
        //$("#" + target).append('<a href="intent://arvr.google.com/scene-viewer/1.0?file=https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/Avocado/glTF/Avocado.gltf#Intent;scheme=https;package=com.google.android.googlequicksearchbox;action=android.intent.action.VIEW;S.browser_fallback_url=https://developers.google.com/ar;end;"><img class="imgClass" src="ab/assets/' + objectName + '/' + objectName + '.jpg">Avocado</a>');


        $("#" + target).append('<model-viewer src="ab/assets/' + objectName + '/' + objectName + '.glb" poster="ab/assets/' + objectName + '/' + objectName + '.jpg" ar ar-modes="webxr scene-viewer" loading="eager" reveal="auto" environment-image="neutral" camera-controls ios-src="ab/assets/' + objectName + '/' + objectName + '.usdz"><button slot="ar-button" id="ar-button" onclick="fakeLoader(\'' + target + '\',' + objectNmbr + ')"><img class="imgClass" src="ab/assets/' + objectName + '/' + objectName + '.jpg"></button></model - viewer > ');
        $("#" + target).append('<div id="click" class="click">click it</div>');
        $("#" + target).append('<div id="size" class="size">' + objectSizeGLB + '<br><span class="material-icons">download</span></div>');
    }

    createIndex = function (device) {
        console.log("createIndex");

        list.forEach(function (item, index) {
            if (item.length > 2) {
                objectNmbr = index;
                if (device == "iphone") {
                    createiOSIntro("index")
                } else {
                    createAndroidIntro("index");
                }
            }
        })

        $('#fullON').addClass("invisible");
        $('#index').removeClass("invisible");
    }

    $(document).ready(function () {
        console.log("ready!");


        alert("Preview Version: V3 \n\nbitte screenshots machen, merci");
        //sonstiger Apple check:

        /* 
                const isMobile = ('ontouchstart' in document.documentElement && navigator.userAgent.match(/Mobi/));
        
                if (isMobile) {
         */
        console.log(navigator.userAgent);
        if (/iPhone|iPad|iPod/i.test(navigator.userAgent)) {

            alert("Die Seite wird aufgerufen mit einem iPhone: richtig?\n \n" + navigator.userAgent);

            const a = document.createElement("a");
            if (a.relList.supports("ar")) {
                alert("iOS AR sollte auf diesem Handy funktionieren");
            } else {
                alert("kein Support fuer AR, mal schauen ob es trotzdem geht...?");
                createAndroidIntro("fullON");
                return;
            }
            // iPhone
            if (!objectNmbr) {
                createIndex("iphone");
                return;
            }
            createiOSIntro("fullON");
        } else {
            alert("Die Seite wird aufgerufen mit einem Android Mobile Phone: richtig?\n \n" + navigator.userAgent);
            // Android
            if (!objectNmbr) {
                createIndex("android");
                return;
            }
            createAndroidIntro("fullON");
        }
        /*         } else {
                    // Desktop
                    alert("desktop!");
                    $("#errorDiv").removeClass("invisible");
                    //alert("Desktop:" + navigator.userAgent);
                } */
    });


</script>

<body>

    <div id="errorDiv" class="invisible errorMode">device not supported</div>

    <div id="fullON" class="fullOn"></div>

    <div id="index" class="index invisible"></div>


</body>

</html>