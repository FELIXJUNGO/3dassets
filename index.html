<!DOCTYPE html>
<html>
<meta name="viewport" content="user-scalable=no" />

<HEAD>
    <TITLE>Kueng Caputo Unlimited</TITLE>
    <script src="ab/js/jquery-3.6.0.min.js"></script>
    <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
    <link rel="stylesheet" href="ab/style.css">
</HEAD>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

<style>

</style>

<script>
    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);
    let objectNmbr = urlParams.get('o');

    console.log(objectNmbr);
    if (objectNmbr) {
        if (objectNmbr < 1 || objectNmbr > 200) {
            alert("falscher Link! - versuche es mit https://ar.felixjungo.ch?o=25");
        }
    }




    let list = [];

    //Poster 2: Von links nach rechts:
    // Arbeitsname:
    list[12] = "Fendi-KuengCaputo_RomanMolds_2019_1.reality,2.0 MB,6.1 MB",
        // Arbeitsname:
        list[7] = "KuengCaputo_CosaPensi_Poster_2020.reality,4.9 MB,8.3 M",
        // Arbeitsname:
        list[8] = "Fendi-KuengCaputo_RomanMolds_2019_1.reality,1.9 MB,6.4 MB",
        // Arbeitsname:
        list[9] = "KuengCaputo_CosaPensi_Poster_2020.reality,4.9 MB,8.3 MB",
        // Arbeitsname:
        list[10] = "Fendi-KuengCaputo_RomanMolds_2019_1.reality,3.1 MB,7.5 MB",


        //Poster 1: Von links nach rechts:
        // Arbeitsname:
        list[1] = "KuengCaputo_SandChair_2012.reality,2.0 MB,6.1 MB", //√
        // Arbeitsname:
        list[2] = "KuengCaputo_TooHardToBeTrue_2014.reality,2.3 MB,9.7 MB",//√-paola
        // Arbeitsname:
        list[3] = "KuengCaputo_SiloFurniture_2017_1.reality,1.9 MB,6.4 MB", //√
        // Arbeitsname:
        list[4] = "KuengCaputo_SandChair_2018.reality,1.5 MB,5.0 MB", //√
        // Arbeitsname:
        list[5] = "Fendi-KuengCaputo_RomanMolds_2019_2.reality,3.1 MB,7.5 MB", //√
        // Arbeitsname:
        list[6] = "KuengCaputo_CosaPensi_2020_2.reality,3.1 MB,7.5 MB", //√


        //Wallpaper QR1: Backsteinlampen:
        list[22] = "KuengCaputo_CosaPensi_2020_1.reality,4.9 MB,8.1 MB",
        //Wallpaper QR2: Blauer Sandhocker:
        list[21] = "KuengCaputo_SandChair_l_2012.reality,2 MB,5.9 MB",
        //Wallpaper QR3: Gruener Bogen //Evt. Fendi Pult später
        list[23] = "KuengCaputo_CosaPensi x RomanMolds_2019_Stool1_2020.reality,5.1 MB,13 MB",
        //Wallpaper QR4: Facemapping
        list[24] = "MML_OepfuKlub3008.usdz,3 MB,3 MB",


        // New Index:
        list[100] = "KuengCaputo_AsIf_2100_1.usdz, MB, MB",
        list[101] = "KuengCaputo_AsIf_2100_2.usdz, MB, MB",
        list[102] = "KuengCaputo_CosaPensi_2020_1.usdz, MB, MB",
        list[103] = "KuengCaputo_TooHardToBeTrue_2014.usdz,2.3 MB,3.1 MB",
        list[104] = "KuengCaputo_SandChair_2012.usdz,2.0 MB,6.1 MB",
        list[105] = "KuengCaputo_SandChair_2018.usdz,2.0 MB,6.1 MB",
        list[106] = "KuengCaputo_SandChair_2100.usdz,2.0 MB,6.1 MB",
        list[107] = "KuengCaputo_Steinlampe_2100.usdz,34.2 MB,34.3 MB",
        list[108] = "KuengCaputo_SiloFurniture_2017_1.usdz,1.9 MB,1.7 MB",
        list[109] = "KuengCaputo_SiloFurniture_2017_2.usdz,1.9 MB,1.7 MB",
        list[110] = "KuengCaputo_SiloFurniture_2017_3.usdz,1.9 MB,1.7 MB",
        list[111] = "KuengCaputo_SiloFurniture_2017_4.usdz,1.9 MB,1.7 MB",
        list[112] = "KuengCaputo_SiloFurniture_2017_5.usdz,5.1 MB,4.4 MB",
        list[113] = "KuengCaputo_Saeulen_2100.usdz,3.3 MB, 3.0 MB",
        list[114] = "KuengCaputo_OnOff Table_2100.usdz,4.9 MB, 4.5 MB",
        list[115] = "KuengCaputo_CosaPensi_2020_2.usdz,5.6 MB,4.8 MB",
        list[116] = "KuengCaputo_CosaPensi x RomanMolds_2019_Stool1_2020.usdz,5.6 MB,4.8 MB",
        list[117] = "KuengCaputo_Teppich_2100.usdz,2.4 MB,2.4 MB",
        list[118] = "Fendi-KuengCaputo_RomanMolds_2019_1.usdz,1.6 MB,1.4 MB",
        list[119] = "Fendi-KuengCaputo_RomanMolds_2019_2.usdz,3.1 MB,3.1 MB",
        list[120] = "Fendi-KuengCaputo_RomanMolds_2019_3.usdz,39.4 MB,11.1 MB",
        list[121] = "Fendi-KuengCaputo_RomanMolds_2019_4.usdz,14.7 MB,12.7 MB",
        list[122] = "Fendi-KuengCaputo_RomanMolds_2019_5.usdz,3.3 MB,3 MB",
        list[123] = "Fendi-KuengCaputo_RomanMolds_2019_6.usdz,24.4 MB,22.7 MB",
        list[124] = "MML_OepfuKlub3008_2100_1.usdz,6.2 MB,6.2 MB",

        console.log(list);



    function fakeLoader(target, objectNmbrS) {
        console.log("objectNmnr:" + objectNmbrS)
        $("#" + objectNmbrS).addClass("selected");
        console.log("fakeLoader" + target);
        $("#" + target).append("<div id='loadingDiv' class='loading'><progress class='pure-material-progress-circular' /></div>");
        $("#click").empty();
        $("#ar-button").addClass("invisible");
        var myTimer = setInterval(checkFocus, 300);

        setInterval(() => {
            $("#loadingDiv").remove();
            //$("#" + objectNmbrS).removeClass("selected");
            clearInterval(myTimer);
        }, 10000);

        function checkFocus() {
            if (document.hasFocus()) {
                console.log("hasfocus");
            }
            else {
                console.log("has no focus");
                $("#loadingDiv").remove();
                //$("#" + objectNmbrS).removeClass("selected");
                clearInterval(myTimer);
            }
        }
    };

    share = function (seriename, datumasd, indexnummer) {

        const a = seriename;
        const b = datumasd;
        const c = indexnummer;
        const data = {
            text: "Kueng Caputo: " + a + ", " + b,
            url: 'https://kueng-caputo.ch/ab.html?o=' + c,
        }
        if (navigator.share) {
            navigator.share(data)
                .then(() => console.log('Successful share'))
                .catch((error) => log('Error sharing', error));
        } else {
            //        alert("use the share menu after opening the file");
        }
    }


    createiOSIntro = function (target) {
        let objectNameiOS = list[objectNmbr].split(',')[0];
        let objectSizeiOS = list[objectNmbr].split(',')[2];
        let objectName = list[objectNmbr].split('.')[0];
        let objectProperties = objectName.split('_');

        var iosLink = document.createElement("a");
        //iosLink.type = "text/css";
        iosLink.rel = "ar";
        iosLink.href = "ab/assets/" + objectName + "/" + objectNameiOS;
        iosLink.innerHTML = '<img src="ab/assets/' + objectName + '/' + objectName + '.jpg" id="imgSize" class="imgClass">';
        iosLink.id = objectNmbr;
        iosLink.onclick = function () { fakeLoader(target, this.id); }
        if (target == "index") {
            $("#" + target).append('<div class="fileInIndex" id="' + objectNmbr + '"></div>');
            $("#" + objectNmbr).append(iosLink);
            $("#" + objectNmbr).append('<div class="sharebutton" onClick="share(\'' + objectProperties[1] + '\',\'' + objectProperties[2] + '\',\'' + objectNmbr + '\')"><span class="material-icons">ios_share</span><div>');
            $("#" + objectNmbr).append('<div class="l"><f>' + objectProperties[1] + '</f></div><div class="r"><g>' + objectProperties[2] + '<br>' + objectSizeiOS + '</g></div>');
            return;
        }
        $("#" + target).append(iosLink);
        $("#" + target).append('<div class="sharebutton" onClick="share(\'' + objectProperties[1] + '\',\'' + objectProperties[2] + '\',\'' + objectNmbr + '\')"><span class="material-icons">ios_share</span><div>');
        $("#" + target).append('<div id="click" class="click">click it</div><div id="size" class="size">' + objectSizeiOS + '</div>');
    }

    createAndroidIntro = function (target) {
        console.log(list[objectNmbr].split('.')[0] + target);
        let objectSizeGLB = list[objectNmbr].split(',')[1];
        let objectName = list[objectNmbr].split('.')[0];
        let objectProperties = objectName.split('_');
        if (target == "index") {
            $("#" + target).append('<div class="fileInIndex androidIndex" id="' + objectNmbr + '"></div>');
            $("#" + objectNmbr).append('<model-viewer src="ab/assets/' + objectName + '/' + objectName + '.glb" poster="ab/assets/' + objectName + '/' + objectName + '.jpg" ar ar-modes="webxr scene-viewer" reveal = "interaction" environment - image="neutral" camera-controls ios-src="ab/assets/' + objectName + '/' + objectName + '.usdz" ><button slot="ar-button" id="ar-button" onclick="fakeLoader(\'' + target + '\',' + objectNmbr + ')"><img class="imgClass" src="ab/assets/' + objectName + '/' + objectName + '.jpg"></button></model - viewer > ');
            $("#" + objectNmbr).append('<div class="sharebutton fullOnShare" onClick="share(\'' + objectProperties[1] + '\',\'' + objectProperties[2] + '\',\'' + objectNmbr + '\')"><span class="material-icons">ios_share</span><div>');
            $("#" + objectNmbr).append('<div class="l"><f>' + objectProperties[1] + '</f></div><div class="r"><g>' + objectProperties[2] + '<br>' + objectSizeGLB + '</g></div>');
            return;
        }

        //direct intent link - geht leider nicht
        //$("#" + target).append('<a href="intent://arvr.google.com/scene-viewer/1.0?file=https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/Avocado/glTF/Avocado.gltf#Intent;scheme=https;package=com.google.android.googlequicksearchbox;action=android.intent.action.VIEW;S.browser_fallback_url=https://developers.google.com/ar;end;"><img class="imgClass" src="ab/assets/' + objectName + '/' + objectName + '.jpg">Avocado</a>');


        $("#" + target).append('<model-viewer src="ab/assets/' + objectName + '/' + objectName + '.glb" poster="ab/assets/' + objectName + '/' + objectName + '.jpg" ar ar-modes="webxr scene-viewer" loading="eager" reveal="auto" environment-image="neutral" camera-controls ios-src="ab/assets/' + objectName + '/' + objectName + '.usdz"><button slot="ar-button" id="ar-button" onclick="fakeLoader(\'' + target + '\',' + objectNmbr + ')"><img class="imgClass" src="ab/assets/' + objectName + '/' + objectName + '.jpg"></button></model - viewer > ');
        $("#" + target).append('<div id="click" class="click">click it</div>');
        $("#" + target).append('<div class="sharebutton fullOnShare" onClick="share(\'' + objectProperties[1] + '\',\'' + objectProperties[2] + '\',\'' + objectNmbr + '\')"><span class="material-icons">ios_share</span><div>');
        $("#" + target).append('<div id="size" class="size">' + objectSizeGLB + '<br><span class="material-icons">download</span></div>');
    }

    createIndex = function (device) {
        console.log("createIndex");

        list.forEach(function (item, index) {
            if (index >= 100) {
                console.log(item, index);
                if (item.length > 2) {
                    objectNmbr = index;
                    if (device == "iphone") {
                        createiOSIntro("index")
                    } else {
                        createAndroidIntro("index");
                    }
                }
            }
        })

        $('#fullON').addClass("invisible");
        $('#index').removeClass("invisible");
    }

    $(document).ready(function () {
        console.log("ready!");


        //alert("Preview Version: V5 \n\nbitte screenshots machen, merci");
        //sonstiger Apple check:

        /* 
                const isMobile = ('ontouchstart' in document.documentElement && navigator.userAgent.match(/Mobi/));
        
                if (isMobile) {
         */
        console.log(navigator.userAgent);
        if (/iPhone|iPad|iPod/i.test(navigator.userAgent)) {

            //alert("Die Seite wird aufgerufen mit einem iPhone: richtig?\n \n" + navigator.userAgent);
            // iPhone
            if (!objectNmbr) {
                createIndex("iphone");
                return;
            }
            const a = document.createElement("a");
            if (a.relList.supports("ar")) {
                //alert("iOS AR sollte auf diesem Handy funktionieren");
            } else {
                //alert("kein Support fuer AR, mal schauen ob es trotzdem geht...?");
                createAndroidIntro("fullON");
                return;
            }

            createiOSIntro("fullON");
        } else {
            //alert("Die Seite wird aufgerufen mit einem Android Mobile Phone: richtig?\n \n" + navigator.userAgent);
            // Android
            if (!objectNmbr) {
                createIndex("android");
                return;
            }
            createAndroidIntro("fullON");
        }
    });


</script>

<body>

    <div id="errorDiv" class="invisible errorMode">device not supported</div>

    <div id="fullON" class="fullOn"></div>

    <div id="index" class="index invisible"></div>


</body>

</html>